name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  release:
    types: [published]

env:
  CARGO_TERM_COLOR: always
  RUST_BACKTRACE: 1
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

permissions:
  contents: write
  id-token: write
  attestations: write

jobs:
  # Stage 1: Trigger Lint Workflow
  trigger-lint:
    name: Trigger Lint and Format
    runs-on: ubuntu-latest
    steps:
      - name: Trigger lint workflow
        uses: actions/github-script@v7

        with:
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'lint.yml',
              ref: context.ref,
              inputs: {
                trigger_source: 'ci-pipeline'
              }
            });
