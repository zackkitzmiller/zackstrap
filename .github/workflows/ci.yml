name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  release:
    types: [published]

env:
  CARGO_TERM_COLOR: always
  RUST_BACKTRACE: 1

permissions:
  contents: write
  id-token: write
  attestations: write

jobs:
  # Stage 1: Code Quality Checks
  lint-and-format:
    uses: ./.github/workflows/lint.yml

  # Stage 2: Testing and Coverage
  test:
    uses: ./.github/workflows/test.yml
    needs: lint-and-format
